<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <title>index</title>
    <script src="/resource/vue.js"></script>
    <script src="/resource/vue-resource.js"></script>
    <link rel="stylesheet" href="/resource/index.css">
    <script src="/resource/index.js"></script>
    <script src="/resource/lodash.js"></script>
    <style>
        .row-def {
            margin-top: 20px
        }

        .player-box {
            /* border: 2px solid #20a0ff; */
            position: relative;
            margin-top: 20px;
            background-color: #ededed;
        }

        .player-box .title {
            margin: 10px
        }

        .board-box {
            border: 1px solid #a9a7a7;
            display: inline-block;
            position: relative;
            width: 30px;
            margin: 10px;
        }

        .board-box span {
            margin: 5px;
        }
    </style>
</head>

<body>
    <div id="app">
        
        <el-row class="row-def">
            <el-input style="width: 180px;" v-model="input" placeholder="请输入安全码"></el-input>
            <el-button
                type="primary"
                @click="rt"
                element-loading-text="解析中"
                v-loading.fullscreen.lock="fullscreenLoading">
                开始
            </el-button>
        </el-row>
        <el-row class="row-def">
            <template>
                <el-tabs v-model="activeName" type="card" @tab-click="handleClick">
                    <el-tab-pane label="用户管理" name="first"></el-tab-pane>
                    <el-tab-pane label="配置管理" name="second"></el-tab-pane>
                </el-tabs>
            </template>
        </el-row>
        <el-row class="row-def">
            <div v-for="player in players" class="player-box">
                <div class="title">{{player.id}}</div>
                <div v-for="board in player.boards" class="board-box">
                    <span>{{board.value}}</span>
                     <img v-bind:src="'/boards/'+board.suit"/>   
                </div>
            </div>
        </el-row>
        <el-row class="row-def">
            <div class="player-box" v-if="player_four.length>0">
                <div class="title">剩下</div>
                <div v-for="board in player_four" class="board-box">
                    <span>{{board.value}}</span>
                     <img v-bind:src="'/boards/'+board.suit"/>   
                </div>
            </div>
        </el-row>
    </div>

    <script>
        var constv = ['A', 'K', 'Q', 'J', '10', '9', '8', '7', '6', '5', '4', '3', '2'];
        var app = new Vue({
            el: '#app',
            data: {
                player_four: [],
                players: [],
                activeName: 'first',
                input: '',
                fullscreenLoading: false
            },
            methods: {
                sortByValue(boards) {
                    boards.sort(function (a, b) {
                        if (constv.indexOf(a.value) > constv.indexOf(b.value)) {
                            return 1;
                        } else if (constv.indexOf(a.value) < constv.indexOf(b.value)) {
                            return -1;
                        } else {
                            return (+a.suit) > (+b.suit) ? 1 : -1;
                        }
                    });
                },
                sortBySuit(boards) {
                    boards.sort(function (a, b) {
                        if ((+a.suit) > (+b.suit)) {
                            return 1;
                        } else if ((+a.suit) < (+b.suit)) {
                            return -1;
                        } else {
                            return constv.indexOf(a.value) > constv.indexOf(b.value) ? 1 : -1;
                        }
                    });
                },
                handleClick() {
                    var that = this;
                    switch (this.activeName) {
                        case 'first':
                            _.forEach(this.players, function (player) {
                                that.sortByValue(player.boards);
                            });
                            this.sortByValue(this.player_four);
                            break;
                        case 'second':
                            _.forEach(this.players, function (player) {
                                that.sortBySuit(player.boards);
                            });
                            this.sortBySuit(this.player_four);
                            break;
                    }
                },
                rt: function () {
                    this.fullscreenLoading = true;
                    Vue.http.get('/rt?pw=' + this.input).then((response) => {
                        if (response && response.body && response.body.data) {
                            let data = response.body.data;
                            this.player_four = data.player_four;
                            this.players = data.players;
                            this.handleClick();
                        } else {
                            this.$message({
                                showClose: true,
                                message: response.body.error,
                                type: 'error'
                            });
                        }
                        this.fullscreenLoading = false;
                        // 响应成功回调
                    }, (response) => {
                        // 响应错误回调
                        this.fullscreenLoading = false;
                    });
                }
            }
        });
    </script>
</body>

</html>